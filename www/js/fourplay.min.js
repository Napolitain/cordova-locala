var Fourplay={init:function(){Fourplay.game=Table.create(7,6," ");Fourplay.elevation=[6,6,6,6,6,6,6];Fourplay.turn="yellow";Fourplay.timeFlag=0;Fourplay.scaling=1;Fourplay.victory=false;var f=window.innerWidth;var e=document.querySelector("svg.svg.fourplay");if(parseInt(e.getAttribute("width"))>=f-20){Fourplay.scaling=(f/(parseInt(e.getAttribute("width"))));e.style.transform="scale("+Fourplay.scaling.toString()+")";var c=((parseInt(e.getAttribute("width"))-parseInt(e.getAttribute("width"))*Fourplay.scaling+15.5)/2).toString();e.style.left="-"+c+"px"}document.querySelector(".fourplay.victory").style.opacity=0;var a=document.querySelector("g.fourplay.cases");for(var d=a.children.length;d>0;d--){a.removeChild(a.children[d-1])}Fourplay.pmap=document.querySelector("g.fourplay.table");if(Fourplay.pmap.children[0]===undefined){Fourplay.map=SVG.create("path");Fourplay.map.setAttribute("class","fourplay box");var g=[["M 30 80 l 0 300 l 390 0 l 0 -300"],[]];for(var d=0;d<Fourplay.game[0].length;d++){g[0].push("l -40 0");for(var b=0;b<Fourplay.game.length-1;b++){g[0].push("l 0 10");g[0].push("a 20 20 0 0 1 0 37.32050807568877");g[1].push("a 20 20 0 0 1 0 -37.32050807568877");g[1].push("l 0 -10")}g[0].push("l 0 10 a 20 20 0 0 1 0 37.32050807568877 a 20 20 0 0 1 -10.471975511965976 0 a 20 20 0 0 1 0 -37.32050807568877 l 0 -10");g[0]=g[0].concat(g[1]);g[1]=[]}g[0].push("z");Fourplay.map.setAttribute("d",g[0].join(" "));SVG.add(Fourplay.map,"g.fourplay.table");setTimeout(function(){Fourplay.map.setAttribute("class","fourplay box completed");document.addEventListener("mousedown",Fourplay.event);document.addEventListener("mousemove",Fourplay.play.move);document.addEventListener("mouseup",Fourplay.play.drop)},3100)}Fourplay.positions=document.querySelector("path.fourplay.box").getBoundingClientRect();Fourplay.state=0},event:function(a){if((a.clientX>=Fourplay.positions.left&&a.clientX<=Fourplay.positions.right)&&(a.clientY>=Fourplay.positions.top&&a.clientY<=Fourplay.positions.bottom)){Fourplay.play.make(a.clientX,a.clientY)}else{if(Date.now()-Fourplay.timeFlag<=150){Fourplay.init()}else{Fourplay.timeFlag=Date.now()}}},play:{make:function(a,b){Fourplay.play.columnLength=50*Fourplay.scaling;Fourplay.play.column=Math.round((a-Fourplay.positions.left)/Fourplay.play.columnLength);if(Fourplay.elevation[Fourplay.play.column-1]<1){return false}if(Fourplay.victory===true){return false}if(Fourplay.play.column<=0){Fourplay.play.column=1}if(Fourplay.play.column>=8){Fourplay.play.column=7}Fourplay.play.chip=SVG.create("path");Fourplay.play.chip.setAttribute("class","fourplay case "+Fourplay.turn);Fourplay.play.chip.setAttribute("d","M "+(50*Fourplay.play.column+0.5*Fourplay.play.column).toString()+" 40 a 20 20 0 0 1 40 0 a 20 20 0 0 1 -40 0");Fourplay.play.chip.style.fill=Fourplay.turn;Fourplay.play.chip.style.transform="translate(0px, 0px)";SVG.add(Fourplay.play.chip,"g.fourplay.cases");Fourplay.state=1},move:function(b){if(Fourplay.play.chip!==undefined){var a=Math.round((b.clientX-Fourplay.positions.left)/Fourplay.play.columnLength);if(a<=0){a=1}if(a>=8){a=7}if(Fourplay.play.column!==a){var c=parseFloat(Fourplay.play.chip.style.transform.split("(")[1].split(",")[0]);Fourplay.play.chip.style.transform="translate("+((a-Fourplay.play.column)*50.5+c).toString()+"px, 0px)";Fourplay.play.column=a}}},drop:function(b){if(Fourplay.play.chip!==undefined){var a=Fourplay.play.chip.style.transform.split("(")[1].split(",")[0];Fourplay.play.chip.style.transform="translate("+a+","+(47.79248358765474*Fourplay.elevation[Fourplay.play.column-1]+20).toString()+"px)";SVG.add(Fourplay.pmap,"svg.svg.fourplay");Fourplay.game[Fourplay.elevation[Fourplay.play.column-1]-1][Fourplay.play.column-1]=Fourplay.turn;if(Fourplay.checkWin()!==false){Fourplay.victory=true;var c=document.querySelector(".fourplay.victory");if(Fourplay.turn==="yellow"){c.innerHTML="yellow won!"}else{c.innerHTML="red won!"}c.style.opacity=1}Fourplay.turn==="yellow"?Fourplay.turn="red":Fourplay.turn="yellow";Fourplay.elevation[Fourplay.play.column-1]--;delete Fourplay.play.chip}}},checkWin:function(){return Table.pattern(Fourplay.game,Fourplay.turn.repeat(4))}};